<!DOCTYPE html>
<html>
<head>
  <title>Family Tree CRUD</title>
  <!-- Include Bootstrap CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
  <!-- Include jQuery -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <!-- Include Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.6.6/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.6/firebase-database.js"></script>
  <!-- Include BALKAN FamilyTreeJS library -->
  <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/balkan-family-tree/dist/Balkan-Family-Tree.css"> -->
  <script src="https://cdn.jsdelivr.net/gh/iamraghavan/Vanshavali@main/familytree.js"></script>
</head>
<body>
  <div class="container">
    <h1>Family Tree CRUD</h1>
    <div id="familyTree"></div>
    <div id="formContainer" style="display: none;">
      <h3>Add/Update Node</h3>
      <form id="nodeForm">
        <div class="form-group">
          <label for="nodeId">Node ID:</label>
          <input type="text" class="form-control" id="nodeId" readonly>
        </div>
        <div class="form-group">
          <label for="nodeName">Node Name:</label>
          <input type="text" class="form-control" id="nodeName">
        </div>
        <div class="form-group">
          <label for="nodeParent">Parent ID:</label>
          <input type="text" class="form-control" id="nodeParent" readonly>
        </div>
        <button type="submit" class="btn btn-primary">Save</button>
        <button type="button" class="btn btn-danger" id="deleteNodeBtn">Delete</button>
        <button type="button" class="btn btn-secondary" id="cancelBtn">Cancel</button>
      </form>
    </div>
  </div>

    <!-- The core Firebase JS SDK is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/8.6.7/firebase-app.js"></script>

    <!-- TODO: Add SDKs for Firebase products that you want to use
        https://firebase.google.com/docs/web/setup#available-libraries -->
    <script src="https://www.gstatic.com/firebasejs/8.6.7/firebase-analytics.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.7/firebase-auth.js"></script>


<script src="https://www.gstatic.com/firebasejs/8.9.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.9.0/firebase-auth.js"></script>

  <!-- Include your Firebase config and initialize the app -->
  <script>
    // Replace with your own Firebase configuration
    var firebaseConfig = {
        apiKey: "AIzaSyDVVWLah77CZOVjBqBweWbuPJpnhrHVg_Y",
  authDomain: "portfolio-4bf1c.firebaseapp.com",
  databaseURL: "https://portfolio-4bf1c-default-rtdb.firebaseio.com",
  projectId: "portfolio-4bf1c",
  storageBucket: "portfolio-4bf1c.appspot.com",
  messagingSenderId: "296534124626",
  appId: "1:296534124626:web:133b828c2ecffa7d4f978b",
  measurementId: "G-EQ2J4C5ZGP"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
  var auth = firebase.auth();

    // Get a reference to the Firebase database
    var database = firebase.database();
  </script>

  <!-- Include your custom JavaScript code -->
  <script>
    $(document).ready(function() {
      var selectedNode = null;
      var familyTree = null;
      var familyData = {};

      // Initialize the Family Tree
      familyTree = new FamilyTree({
        selector: '#familyTree',
        firebase: {
          database: database,
          root: 'family'
        },
        // Add more configuration options here
      });

      // Enable node selection
      familyTree.on('nodeSelected', function(node) {
        selectedNode = node;
        showForm();
        fillForm(selectedNode);
      });

      // Enable form submission
      $('#nodeForm').on('submit', function(e) {
        e.preventDefault();
        saveNode();
      });

      // Enable delete button
      $('#deleteNodeBtn').on('click', function() {
        deleteNode(selectedNode);
      });

      // Enable cancel button
      $('#cancelBtn').on('click', function() {
        clearForm();
        hideForm();
      });

      // Function to show the form
      function showForm() {
        $('#formContainer').show();
      }

      // Function to hide the form
      function hideForm() {
        $('#formContainer').hide();
      }

      // Function to fill the form with node data
      function fillForm(node) {
        $('#nodeId').val(node.id);
        $('#nodeName').val(node.name);
        $('#nodeParent').val(node.parentId);
      }

      // Function to clear the form
      function clearForm() {
        $('#nodeId').val('');
        $('#nodeName').val('');
        $('#nodeParent').val('');
      }

      // Function to save/update a node
      function saveNode() {
        var nodeId = $('#nodeId').val();
        var nodeName = $('#nodeName').val();
        var nodeParent = $('#nodeParent').val();

        if (nodeId) {
          // Update existing node
          familyData[nodeId].name = nodeName;
        } else {
          // Create new node
          nodeId = Date.now().toString();
          familyData[nodeId] = {
            name: nodeName,
            parent: nodeParent
          };
        }

        // Save the family data to Firebase
        database.ref('family').set(familyData)
          .then(function() {
            clearForm();
            hideForm();
          })
          .catch(function(error) {
            console.error('Error saving family data:', error);
          });
      }

      // Function to delete a node
      function deleteNode(node) {
        if (node) {
          delete familyData[node.id];

          // Save the family data to Firebase
          database.ref('family').set(familyData)
            .then(function() {
              clearForm();
              hideForm();
            })
            .catch(function(error) {
              console.error('Error saving family data:', error);
            });
        }
      }

      // Fetch family data from Firebase
      database.ref('family').once('value')
        .then(function(snapshot) {
          familyData = snapshot.val();
          familyTree.loadData(familyData);
        })
        .catch(function(error) {
          console.error('Error fetching family data:', error);
        });
    });
  </script>
</body>
</html>
